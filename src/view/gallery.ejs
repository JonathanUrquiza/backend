<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= view.title %></title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #e0e0e0;
        }
        .header {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.4);
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid #333;
        }
        .header h1 {
            color: #ffffff;
            margin: 0 0 20px 0;
        }
        .upload-btn {
            display: inline-block;
            background-color: #0d7377;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(13, 115, 119, 0.3);
        }
        .upload-btn:hover {
            background-color: #14a085;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(13, 115, 119, 0.4);
        }
        .header-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .download-all-btn {
            display: inline-block;
            background-color: #2d5a27;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(45, 90, 39, 0.3);
        }
        .download-all-btn:hover {
            background-color: #3d7c36;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(45, 90, 39, 0.4);
        }
        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #404040;
        }
        .download-zone-btn {
            background-color: #1f4e79;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(31, 78, 121, 0.3);
        }
        .download-zone-btn:hover {
            background-color: #2d6aa3;
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(31, 78, 121, 0.4);
        }
        .stats {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            color: #14a085;
            font-weight: bold;
            border: 1px solid #404040;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            background-color: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #404040;
        }
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            border-color: #14a085;
        }
        .image-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
        }
        .image-info {
            padding: 15px;
        }
        .filename {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 8px;
            word-break: break-all;
        }
        .upload-date {
            color: #b0b0b0;
            font-size: 14px;
        }
        .no-images {
            text-align: center;
            color: #b0b0b0;
            font-size: 18px;
            background-color: #2a2a2a;
            padding: 60px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            border: 1px solid #404040;
        }
        .no-images i {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
            opacity: 0.7;
        }
        .no-images h2 {
            color: #ffffff;
        }
        
        /* Modal para ver imagen en grande */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.95);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }
        .modal-content img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: #fff;
        }
        
        .zone-section {
            margin-bottom: 40px;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            border: 1px solid #333;
        }
        .zone-title {
            color: #ffffff;
            margin: 0;
            font-size: 24px;
            flex: 1;
        }
        .zone-count {
            color: #b0b0b0;
            font-weight: normal;
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 15px;
            }
            .image-card img {
                height: 150px;
            }
            .zone-section {
                padding: 15px;
                margin-bottom: 30px;
            }
            .zone-title {
                font-size: 20px;
            }
            .zone-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .download-zone-btn {
                align-self: flex-end;
            }
            .header-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><%= view.title %></h1>
        <div class="header-buttons">
            <a href="/upload" class="upload-btn">üìÅ Cargar Nuevas Im√°genes</a>
            <% if (totalImages && totalImages > 0) { %>
                <a href="/download/all" class="download-all-btn">üì¶ Descargar Todas</a>
            <% } %>
        </div>
    </div>
    
    <% if (totalImages && totalImages > 0) { %>
        <div class="stats">
            üìä Total de im√°genes: <%= totalImages %> | üìÅ Zonas con contenido: <%= Object.keys(zonesData).length %>
        </div>
        
        <% Object.keys(zonesData).forEach(function(zoneKey) { %>
            <% const zone = zonesData[zoneKey]; %>
            <div class="zone-section">
                <div class="zone-header">
                    <h2 class="zone-title">
                        üìÅ <%= zone.displayName %> 
                        <span class="zone-count">(<%= zone.count %> <%= zone.count === 1 ? 'imagen' : 'im√°genes' %>)</span>
                    </h2>
                    <% if (zoneKey !== 'sin_zona') { %>
                        <a href="/download/zona/<%= zoneKey %>" class="download-zone-btn">‚¨áÔ∏è Descargar Zona</a>
                    <% } else { %>
                        <a href="/download/zona/sin_zona" class="download-zone-btn">‚¨áÔ∏è Descargar</a>
                    <% } %>
                </div>
                
                <div class="gallery">
                    <% zone.images.forEach(function(image, index) { %>
                        <div class="image-card">
                            <img src="<%= image.path %>" alt="<%= image.filename %>" onclick="openModal('<%= image.path %>', '<%= image.filename %>', '<%= zone.displayName %>', '<%= image.usuario %>')">
                            <div class="image-info">
                                <div class="filename"><%= image.filename %></div>
                                <div class="upload-date">
                                    üë§ <%= image.usuario %><br>
                                    üìÖ <%= new Date(image.uploadedAt).toLocaleString('es-ES', {
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    }) %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div class="no-images">
            <i>üì∑</i>
            <h2>No hay im√°genes cargadas</h2>
            <p>¬°Empieza subiendo algunas im√°genes de actas!</p>
            <br>
            <a href="/upload" class="upload-btn">Cargar Primera Imagen</a>
        </div>
    <% } %>
    
    <!-- Modal para ver imagen en tama√±o completo -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        function openModal(imageSrc, filename, zona, usuario) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modal.style.display = 'block';
            modalImg.src = imageSrc;
            modalImg.alt = `${filename} - ${zona} - Subida por ${usuario}`;
        }
        
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }
        
        // Cerrar modal con tecla ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        // Prevenir que el modal se cierre al hacer clic en la imagen
        document.getElementById('modalImage').addEventListener('click', function(event) {
            event.stopPropagation();
        });
    </script>
</body>
</html>
